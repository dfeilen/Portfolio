<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Photography Portfolio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow: hidden;
      background: #fafafa;
      position: relative;
    }

    /* DF Logo */
    #df-logo {
      position: fixed;
      top: 20px;
      right: 20px;
      font-family: 'Barlow', sans-serif;
      font-weight: 700;
      font-size: 24px;
      color: #000;
      z-index: 300;
      letter-spacing: -1px;
    }

    /* Loading indicator */
    #loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 1000;
    }

    #loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #000;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* About button (top-left corner) */
    #about-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      z-index: 300;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      font-weight: 600;
      font-size: 16px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: background 0.2s ease;
    }

    #about-btn:hover {
      background: rgba(0, 0, 0, 0.9);
    }

    #about-btn:focus {
      outline: 2px solid rgba(0, 0, 0, 0.5);
      outline-offset: 2px;
    }

    #about-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 500;
      justify-content: center;
      align-items: center;
    }

    #about-content {
      background: #fff;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      border-radius: 8px;
      font-size: 16px;
      line-height: 1.5;
      position: relative;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
    }

    #about-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      font-weight: bold;
      color: #000;
      cursor: pointer;
      background: none;
      border: none;
      padding: 5px 10px;
    }

    #about-close:hover {
      color: #666;
    }

    #about-close:focus {
      outline: 2px solid #000;
      outline-offset: 2px;
    }

    #results {
      width: 100%;
      height: 100vh;
      position: relative;
      top: 0;
      left: 0;
    }

    #results img {
      position: absolute;
      border-radius: 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s ease;
      cursor: grab;
      height: auto;
      max-width: 500px;
      opacity: 0;
      animation: fadeIn 0.3s ease forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    #results img:active {
      cursor: grabbing;
    }

    #results img:focus {
      outline: 3px solid #000;
      outline-offset: 2px;
    }

    /* Resize handle */
    .resize-handle {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #000;
      border: 2px solid #fff;
      border-radius: 50%;
      bottom: -10px;
      right: -10px;
      cursor: nwse-resize;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: auto;
    }

    .image-wrapper:hover .resize-handle {
      opacity: 1;
    }

    .image-wrapper {
      position: absolute;
      line-height: 0;
    }

    .image-wrapper img {
      position: relative;
      display: block;
    }

    /* Lightbox styles */
    #lightbox {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      cursor: zoom-out;
    }

    #lightbox img {
      max-width: 90vw;
      max-height: 90vh;
      width: auto;
      height: auto;
      object-fit: contain;
      box-shadow: 0 4px 20px rgba(255,255,255,0.1);
      cursor: zoom-out;
      position: relative;
    }

    #lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 40px;
      color: white;
      cursor: pointer;
      background: none;
      border: none;
      padding: 10px;
      line-height: 1;
      z-index: 1001;
    }

    #lightbox-close:hover {
      color: #ccc;
    }

    #lightbox-close:focus {
      outline: 2px solid #fff;
      outline-offset: 2px;
    }

    /* Mobile gallery view */
    @media (max-width: 768px) {
      body {
        background: #fff;
      }

      #results {
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
        overflow-y: auto;
        scroll-snap-type: y mandatory;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        background: #fff;
        height: 100vh;
      }

      #results::-webkit-scrollbar {
        display: none;
      }

      #results img {
        position: relative;
        flex-shrink: 0;
        width: 100vw;
        height: 100vh;
        max-width: 100vw;
        object-fit: contain;
        scroll-snap-align: start;
        box-sizing: border-box;
        cursor: default;
        left: auto !important;
        top: auto !important;
        animation: none;
        opacity: 1;
        box-shadow: none;
        padding: 20px;
      }

      #results.zoomed {
        overflow: hidden;
        scroll-snap-type: none;
      }

      #results img.zoomed {
        object-fit: cover;
        cursor: zoom-out;
        z-index: 1000;
      }

      #mobile-indicator {
        display: none;
      }
      
      #about-btn {
        padding: 8px 16px;
        font-size: 15px;
        top: 12px;
        left: 12px;
        background: rgba(0, 0, 0, 0.75);
        color: white;
        z-index: 1001;
        border-radius: 18px;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
      }

      #about-btn:hover {
        background: rgba(0, 0, 0, 0.85);
      }

      #about-content {
        padding: 20px;
        font-size: 14px;
      }

      #df-logo {
        top: 12px;
        right: 12px;
        font-size: 20px;
      }
    }

    /* Desktop - hide mobile indicator */
    #mobile-indicator {
      display: none;
    }

    /* Mobile welcome popup */
    #mobile-welcome {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }

    #mobile-welcome-content {
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      max-width: 340px;
      width: 100%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      text-align: center;
    }

    #mobile-welcome-content p {
      margin: 0 0 20px 0;
      font-size: 15px;
      line-height: 1.5;
      color: #333;
    }

    #mobile-welcome-btn {
      background: rgba(0, 0, 0, 0.8);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
    }

    #mobile-welcome-btn:active {
      background: rgba(0, 0, 0, 0.9);
    }
  </style>
</head>
<body>
  <button id="about-btn" aria-label="About this portfolio">About</button>
  <div id="df-logo">DF</div>

  <div id="loading" role="status" aria-live="polite">
    <div id="loading-spinner" aria-hidden="true"></div>
    <p>Loading photos...</p>
  </div>

  <div id="results" role="main" aria-label="Photo gallery"></div>

  <div id="mobile-indicator"></div>

  <div id="lightbox" role="dialog" aria-labelledby="lightbox-img" aria-modal="true">
    <button id="lightbox-close" aria-label="Close fullscreen view">&times;</button>
    <img id="lightbox-img" alt="" />
  </div>

  <div id="mobile-welcome">
    <div id="mobile-welcome-content">
      <p>Hi! This portfolio is best experienced on a desktop or a screen larger than the one you're viewing it on. This is a simplified mobile version, but still gives you random images as you scroll.</p>
      <button id="mobile-welcome-btn">Got it!</button>
    </div>
  </div>

  <div id="about-modal" role="dialog" aria-labelledby="about-heading" aria-modal="true">
    <div id="about-content">
      <button id="about-close" aria-label="Close about dialog">&times;</button>
      <h2 id="about-heading">What is this?</h2>
      <p>
        My name is Devin Feilen, and this is my ongoing photography portfolio.
      </p>
      <p>
        Squarespace sites are cool, but I made this myself and I feel that it provides a more intriguing representation of my work instead of your "typical" photography portfolio. The photos are randomly scattered across the screen and you can drag them around to explore. There are thousands of photos to discover and it's almost impossible to get the same spread, so hopefully it'll keep you out of the doom scroll app for a bit.
      </p>
      <p>
        If you'd like to support me, you can do so at <a href="https://buymeacoffee.com/devinfeilen" target="_blank" rel="noopener noreferrer">buymeacoffee.com/devinfeilen</a>
      </p>
    </div>
  </div>

  <script>
    let allPhotos = [];
    let photoQueue = [];
    let zIndexCounter = 1;
    let imagesData = [];
    const topBuffer = 60;
    let loadedCount = 0;
    const isMobileDevice = window.innerWidth <= 768;
    const initialLoadCount = isMobileDevice ? 10 : 15;
    let isLoadingMore = false;

    // Load photos immediately
    fetch("photos.json")
      .then(res => res.json())
      .then(data => {
        allPhotos = data;
        resetQueue();
        console.log("âœ… Loaded", allPhotos.length, "photos");
        loadInitialPhotos();
      })
      .catch(err => {
        console.error("Error loading photos.json:", err);
        document.getElementById("loading").innerHTML = "<p>Error loading photos. Please refresh the page.</p>";
      });

    function resetQueue() {
      photoQueue = shuffleArray([...allPhotos]);
    }

    function getNextBatch(count) {
      if (photoQueue.length < count) {
        resetQueue();
      }
      return photoQueue.splice(0, count);
    }

    function loadInitialPhotos() {
      // Hide loading indicator immediately since JSON loaded successfully
      document.getElementById("loading").style.display = "none";
      
      // Show mobile welcome popup on mobile devices
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        showMobileWelcome();
      }
      
      const batch = getNextBatch(initialLoadCount);
      addImages(batch);
    }

    function showMobileWelcome() {
      const welcomePopup = document.getElementById("mobile-welcome");
      const welcomeBtn = document.getElementById("mobile-welcome-btn");
      
      welcomePopup.style.display = "flex";
      
      welcomeBtn.onclick = () => {
        welcomePopup.style.display = "none";
      };
      
      // Also close on background click
      welcomePopup.onclick = (e) => {
        if (e.target === welcomePopup) {
          welcomePopup.style.display = "none";
        }
      };
    }

    function addImages(selected) {
      const resultsDiv = document.getElementById("results");
      const isMobile = window.innerWidth <= 768;
      
      selected.forEach((src, index) => {
        const img = new Image();
        img.src = src;
        img.alt = `Photography by Devin Feilen - Image ${loadedCount + index + 1}`;
        img.loading = "lazy";
        img.tabIndex = 0;
        img.setAttribute('role', 'img');
        
        img.onload = () => {
          loadedCount++;

          if (!isMobile) {
            // Desktop: scattered draggable layout with wrapper
            const wrapper = document.createElement('div');
            wrapper.className = 'image-wrapper';
            
            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'resize-handle';
            resizeHandle.setAttribute('aria-label', 'Resize image');

            const maxDim = Math.min(window.innerWidth * 0.8, window.innerHeight * 0.8, 500);
            
            let scale = Math.min(
              maxDim / img.naturalWidth,
              maxDim / img.naturalHeight,
              1
            );
            
            const width = img.naturalWidth * scale;
            const height = img.naturalHeight * scale;
            
            img.style.width = width + "px";
            img.style.height = height + "px";

            const maxX = window.innerWidth - width;
            const maxY = window.innerHeight - height - topBuffer;
            
            const x = Math.random() * maxX;
            const y = Math.random() * maxY + topBuffer;
            
            wrapper.style.left = x + "px";
            wrapper.style.top = y + "px";
            wrapper.style.zIndex = zIndexCounter++;

            wrapper.appendChild(img);
            wrapper.appendChild(resizeHandle);

            makeDraggable(wrapper, img);
            makeResizable(wrapper, img, resizeHandle);
            makeExpandable(img);
            
            resultsDiv.appendChild(wrapper);

            imagesData.push({
              wrapper,
              img,
              width,
              height,
              relX: x / maxX,
              relY: (y - topBuffer) / maxY
            });
          } else {
            resultsDiv.appendChild(img);
          }

          // Setup infinite scroll for mobile
          if (isMobile && !resultsDiv.hasAttribute('data-scroll-setup')) {
            setupMobileInfiniteScroll();
            resultsDiv.setAttribute('data-scroll-setup', 'true');
          }
        };

        img.onerror = () => {
          console.error("Failed to load image:", src);
        };
      });
    }

    function makeMobileTappable(img) {
      let touchStartTime = 0;
      let touchStartX = 0;
      let touchStartY = 0;

      img.addEventListener('touchstart', (e) => {
        touchStartTime = Date.now();
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      });

      img.addEventListener('touchend', (e) => {
        const touchEndTime = Date.now();
        const touchDuration = touchEndTime - touchStartTime;
        const touchEndX = e.changedTouches[0].clientX;
        const touchEndY = e.changedTouches[0].clientY;
        const moveX = Math.abs(touchEndX - touchStartX);
        const moveY = Math.abs(touchEndY - touchStartY);

        // If it's a quick tap (not a scroll), toggle zoom
        if (touchDuration < 200 && moveX < 10 && moveY < 10) {
          e.preventDefault();
          toggleMobileZoom(img);
        }
      });
    }

    function toggleMobileZoom(img) {
      const resultsDiv = document.getElementById("results");
      const isZoomed = img.classList.contains('zoomed');

      if (isZoomed) {
        // Zoom out
        img.classList.remove('zoomed');
        resultsDiv.classList.remove('zoomed');
      } else {
        // Zoom in
        img.classList.add('zoomed');
        resultsDiv.classList.add('zoomed');
      }
    }

    function setupMobileInfiniteScroll() {
      const resultsDiv = document.getElementById("results");
      
      resultsDiv.addEventListener('scroll', () => {
        // Check if we're near the bottom
        const scrollTop = resultsDiv.scrollTop;
        const scrollHeight = resultsDiv.scrollHeight;
        const clientHeight = resultsDiv.clientHeight;
        
        // Load more when within 2 images of the bottom
        if (scrollTop + clientHeight >= scrollHeight - (clientHeight * 2)) {
          loadMoreMobileImages();
        }
      });
    }

    function loadMoreMobileImages() {
      if (isLoadingMore) return;
      isLoadingMore = true;
      
      const batch = getNextBatch(5); // Load 5 more images at a time
      const resultsDiv = document.getElementById("results");
      
      batch.forEach(src => {
        const img = new Image();
        img.src = src;
        img.alt = `Photography by Devin Feilen - Image ${loadedCount + 1}`;
        img.loading = "lazy";
        img.tabIndex = 0;
        img.setAttribute('role', 'img');
        
        img.onload = () => {
          loadedCount++;
          makeMobileTappable(img);
          resultsDiv.appendChild(img);
        };

        img.onerror = () => {
          console.error("Failed to load image:", src);
        };
      });
      
      // Reset loading flag after a short delay
      setTimeout(() => {
        isLoadingMore = false;
      }, 500);
    }

    function makeDraggable(wrapper, img) {
      // Only make draggable on desktop
      if (window.innerWidth <= 768) return;

      let offsetX, offsetY, isDragging = false;

      // Prevent default drag behavior
      if (img) {
        img.ondragstart = () => false;
      }

      // Mouse events on image
      if (img) {
        img.addEventListener("mousedown", e => {
          e.preventDefault();
          startDrag(e.clientX, e.clientY);
        });

        // Touch events for mobile
        img.addEventListener("touchstart", e => {
          e.preventDefault();
          const touch = e.touches[0];
          startDrag(touch.clientX, touch.clientY);
        }, { passive: false });

        // Keyboard accessibility
        img.addEventListener("keydown", e => {
          const step = e.shiftKey ? 50 : 10;
          let newLeft = wrapper.offsetLeft;
          let newTop = wrapper.offsetTop;

          switch(e.key) {
            case "ArrowLeft":
              newLeft -= step;
              e.preventDefault();
              break;
            case "ArrowRight":
              newLeft += step;
              e.preventDefault();
              break;
            case "ArrowUp":
              newTop -= step;
              e.preventDefault();
              break;
            case "ArrowDown":
              newTop += step;
              e.preventDefault();
              break;
            default:
              return;
          }

          if (newTop < topBuffer) newTop = topBuffer;
          wrapper.style.left = newLeft + "px";
          wrapper.style.top = newTop + "px";
          wrapper.style.zIndex = zIndexCounter++;
        });
      }

      function startDrag(clientX, clientY) {
        if (isDragging) return;
        isDragging = true;
        offsetX = clientX - wrapper.offsetLeft;
        offsetY = clientY - wrapper.offsetTop;
        wrapper.style.zIndex = zIndexCounter++;
        wrapper.style.transition = "none";
        if (img) img.style.cursor = "grabbing";

        function onMove(clientX, clientY) {
          let newLeft = clientX - offsetX;
          let newTop = clientY - offsetY;
          if (newTop < topBuffer) newTop = topBuffer;
          wrapper.style.left = newLeft + "px";
          wrapper.style.top = newTop + "px";
        }

        function onMouseMove(e) {
          onMove(e.clientX, e.clientY);
        }

        function onTouchMove(e) {
          e.preventDefault();
          const touch = e.touches[0];
          onMove(touch.clientX, touch.clientY);
        }

        function stopDrag() {
          isDragging = false;
          wrapper.style.transition = "transform 0.2s ease";
          if (img) img.style.cursor = "grab";
          document.removeEventListener("mousemove", onMouseMove);
          document.removeEventListener("mouseup", stopDrag);
          document.removeEventListener("touchmove", onTouchMove);
          document.removeEventListener("touchend", stopDrag);
        }

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", stopDrag);
        document.addEventListener("touchmove", onTouchMove, { passive: false });
        document.addEventListener("touchend", stopDrag);
      }
    }

    function makeResizable(wrapper, img, handle) {
      let isResizing = false;
      let startWidth, startHeight, startX, startY;
      let aspectRatio = img.naturalWidth / img.naturalHeight;

      handle.addEventListener("mousedown", e => {
        e.preventDefault();
        e.stopPropagation();
        startResize(e.clientX, e.clientY);
      });

      handle.addEventListener("touchstart", e => {
        e.preventDefault();
        e.stopPropagation();
        const touch = e.touches[0];
        startResize(touch.clientX, touch.clientY);
      }, { passive: false });

      function startResize(clientX, clientY) {
        isResizing = true;
        startWidth = img.offsetWidth;
        startHeight = img.offsetHeight;
        startX = clientX;
        startY = clientY;
        wrapper.style.zIndex = zIndexCounter++;

        function onMouseMove(e) {
          if (!isResizing) return;
          const deltaX = e.clientX - startX;
          const deltaY = e.clientY - startY;
          const delta = Math.max(deltaX, deltaY);
          
          let newWidth = startWidth + delta;
          let newHeight = newWidth / aspectRatio;

          // Minimum size
          if (newWidth < 100) {
            newWidth = 100;
            newHeight = newWidth / aspectRatio;
          }

          // Maximum size
          const maxSize = Math.min(window.innerWidth * 0.9, window.innerHeight * 0.9);
          if (newWidth > maxSize || newHeight > maxSize) {
            if (newWidth > newHeight) {
              newWidth = maxSize;
              newHeight = newWidth / aspectRatio;
            } else {
              newHeight = maxSize;
              newWidth = newHeight * aspectRatio;
            }
          }

          img.style.width = newWidth + "px";
          img.style.height = newHeight + "px";

          // Update stored dimensions
          const data = imagesData.find(d => d.img === img);
          if (data) {
            data.width = newWidth;
            data.height = newHeight;
          }
        }

        function onTouchMove(e) {
          e.preventDefault();
          const touch = e.touches[0];
          const deltaX = touch.clientX - startX;
          const deltaY = touch.clientY - startY;
          const delta = Math.max(deltaX, deltaY);
          
          let newWidth = startWidth + delta;
          let newHeight = newWidth / aspectRatio;

          if (newWidth < 100) {
            newWidth = 100;
            newHeight = newWidth / aspectRatio;
          }

          const maxSize = Math.min(window.innerWidth * 0.9, window.innerHeight * 0.9);
          if (newWidth > maxSize || newHeight > maxSize) {
            if (newWidth > newHeight) {
              newWidth = maxSize;
              newHeight = newWidth / aspectRatio;
            } else {
              newHeight = maxSize;
              newWidth = newHeight * aspectRatio;
            }
          }

          img.style.width = newWidth + "px";
          img.style.height = newHeight + "px";

          const data = imagesData.find(d => d.img === img);
          if (data) {
            data.width = newWidth;
            data.height = newHeight;
          }
        }

        function stopResize() {
          isResizing = false;
          document.removeEventListener("mousemove", onMouseMove);
          document.removeEventListener("mouseup", stopResize);
          document.removeEventListener("touchmove", onTouchMove);
          document.removeEventListener("touchend", stopResize);
        }

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", stopResize);
        document.addEventListener("touchmove", onTouchMove, { passive: false });
        document.addEventListener("touchend", stopResize);
      }
    }

    function makeExpandable(img) {
      const lightbox = document.getElementById("lightbox");
      const lightboxImg = document.getElementById("lightbox-img");
      const lightboxClose = document.getElementById("lightbox-close");

      // Double click to expand
      img.addEventListener("dblclick", () => {
        lightboxImg.src = img.src;
        lightboxImg.alt = img.alt;
        lightbox.style.display = "flex";
        lightboxClose.focus();
      });

      // Close lightbox
      lightboxClose.addEventListener("click", () => {
        lightbox.style.display = "none";
        img.focus();
      });

      lightbox.addEventListener("click", e => {
        if (e.target === lightbox || e.target === lightboxImg) {
          lightbox.style.display = "none";
          img.focus();
        }
      });

      // Escape key to close
      lightbox.addEventListener("keydown", e => {
        if (e.key === "Escape") {
          lightbox.style.display = "none";
          img.focus();
        }
      });
    }

    // Handle window resize
    let resizeTimeout;
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        imagesData.forEach(data => {
          if (data.wrapper) {
            const maxX = window.innerWidth - data.width;
            const maxY = window.innerHeight - data.height - topBuffer;
            data.wrapper.style.left = data.relX * maxX + "px";
            data.wrapper.style.top = data.relY * maxY + topBuffer + "px";
          }
        });
      }, 250);
    });

    function shuffleArray(array) {
      return array.map(v => ({v, sort: Math.random()}))
        .sort((a, b) => a.sort - b.sort)
        .map(({v}) => v);
    }

    /* Modal controls */
    const aboutBtn = document.getElementById("about-btn");
    const aboutModal = document.getElementById("about-modal");
    const aboutClose = document.getElementById("about-close");

    aboutBtn.onclick = () => {
      aboutModal.style.display = "flex";
      aboutClose.focus();
    };

    aboutClose.onclick = () => {
      aboutModal.style.display = "none";
      aboutBtn.focus();
    };

    window.onclick = e => {
      if (e.target === aboutModal) {
        aboutModal.style.display = "none";
        aboutBtn.focus();
      }
    };

    // Keyboard accessibility for modal
    aboutModal.addEventListener("keydown", e => {
      if (e.key === "Escape") {
        aboutModal.style.display = "none";
        aboutBtn.focus();
      }
    });

    // Trap focus within modal when open
    aboutModal.addEventListener("keydown", e => {
      if (e.key === "Tab") {
        const focusableElements = aboutModal.querySelectorAll('button, a[href]');
        const firstElement = focusableElements[0];
        const lastElement = focusableElements[focusableElements.length - 1];

        if (e.shiftKey && document.activeElement === firstElement) {
          e.preventDefault();
          lastElement.focus();
        } else if (!e.shiftKey && document.activeElement === lastElement) {
          e.preventDefault();
          firstElement.focus();
        }
      }
    });
  </script>
</body>
</html>
