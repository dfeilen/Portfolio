<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Devin Feilen — Photography</title>
  <meta name="description" content="Photography portfolio by Devin Feilen – exploring cycling culture and spontaneous documentary imagery.">
  <meta property="og:title" content="Devin Feilen — Photography">
  <meta property="og:description" content="An experimental, handmade photo portfolio experience.">
  <meta property="og:image" content="/photos/preview.jpg">
  <meta name="theme-color" content="#fafafa">

  <style>
    body {
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: #fafafa;
      overflow: hidden;
      color: #111;
      position: relative;
    }

    /* Center intro button */
    #button-container {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fafafa;
      z-index: 10;
    }

    #enter-btn {
      font-family: inherit;
      font-size: 1.2rem;
      background: none;
      border: 1px solid #111;
      padding: 0.8rem 1.6rem;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    #enter-btn:hover {
      background: #111;
      color: #fafafa;
    }

    #results {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #results img {
      position: absolute;
      max-width: 320px;
      border: 1px solid #111;
      opacity: 0;
      transition: opacity 0.5s ease, transform 0.2s ease;
      cursor: grab;
    }

    #results img.loaded {
      opacity: 1;
    }

    #results img:active {
      cursor: grabbing;
    }

    /* Button controls */
    .control-btn {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      background: none;
      border: 1px solid #111;
      padding: 0.5rem 1rem;
      font-family: inherit;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .control-btn:hover {
      background: #111;
      color: #fafafa;
    }

    #more-btn {
      left: auto;
      right: 1rem;
    }

    #about-btn {
      top: 1rem;
      right: 1rem;
      bottom: auto;
    }

    /* Modal styling */
    #about-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(250, 250, 250, 0.96);
      z-index: 15;
      padding: 2rem;
      text-align: left;
      overflow-y: auto;
    }

    #about-content {
      max-width: 600px;
      border: 1px solid #111;
      padding: 2rem;
      background: #fff;
      box-shadow: 4px 4px 0 #111;
    }

    #about-content h2 {
      margin-top: 0;
    }

    #close-about {
      margin-top: 1rem;
      background: none;
      border: 1px solid #111;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      font-family: inherit;
    }

    #close-about:hover {
      background: #111;
      color: #fafafa;
    }

    /* Mobile tweaks */
    @media (max-width: 600px) {
      #results img {
        max-width: 60vw;
      }
      .control-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
      }
      #about-content {
        padding: 1.2rem;
      }
    }
  </style>
</head>
<body>

  <!-- Landing -->
  <div id="button-container">
    <button id="enter-btn" aria-label="Enter site">enter</button>
  </div>

  <!-- Main container -->
  <div id="results" aria-live="polite"></div>

  <!-- Controls -->
  <button id="start-btn" class="control-btn" style="display:none;">Start Over</button>
  <button id="more-btn" class="control-btn" style="display:none;">Show Me More</button>
  <button id="about-btn" class="control-btn" style="display:none;">About</button>

  <!-- About Modal -->
  <div id="about-modal">
    <div id="about-content">
      <h2>About</h2>
      <p>This is an evolving photography portfolio by <strong>Devin Feilen</strong> — exploring cycling culture, Portland, and the interplay between documentation and spontaneity.</p>
      <p>Each visit is a slightly different spread — drag and rearrange images as you like. The goal isn’t a fixed gallery, but a living shuffle of moments.</p>
      <button id="close-about">Close</button>
    </div>
  </div>

  <script>
    let allPhotos = [];
    let unusedPhotos = [];

    // Load photos from JSON
    async function loadPhotos() {
      try {
        const response = await fetch("photos.json");
        const data = await response.json();
        allPhotos = data;
        resetQueue();
      } catch (e) {
        console.error("Error loading photos.json:", e);
      }
    }

    function resetQueue() {
      unusedPhotos = [...allPhotos];
    }

    function getRandomPhoto() {
      if (unusedPhotos.length === 0) resetQueue();
      const index = Math.floor(Math.random() * unusedPhotos.length);
      return unusedPhotos.splice(index, 1)[0];
    }

    // Generate random position
    function randomPosition() {
      const x = Math.random() * (window.innerWidth - 320);
      const y = Math.random() * (window.innerHeight - 240);
      return { x, y };
    }

    function showImage() {
      const src = getRandomPhoto();
      const img = document.createElement("img");
      img.src = src;
      img.alt = "Photograph by Devin Feilen";
      img.loading = "lazy";
      const { x, y } = randomPosition();
      img.style.left = `${x}px`;
      img.style.top = `${y}px`;

      img.onload = () => img.classList.add("loaded");
      img.onerror = () => console.warn("Image failed to load:", src);

      // Draggable
      img.addEventListener("mousedown", dragStart);
      document.getElementById("results").appendChild(img);
    }

    // Shuffle and reset
    function shuffleImages() {
      const results = document.getElementById("results");
      results.innerHTML = "";
      for (let i = 0; i < 6; i++) showImage();
    }

    // Dragging logic
    let currentDrag = null;
    let offsetX = 0, offsetY = 0;

    function dragStart(e) {
      currentDrag = e.target;
      offsetX = e.clientX - currentDrag.offsetLeft;
      offsetY = e.clientY - currentDrag.offsetTop;
      document.addEventListener("mousemove", dragMove);
      document.addEventListener("mouseup", dragEnd);
    }

    function dragMove(e) {
      if (!currentDrag) return;
      currentDrag.style.left = `${e.clientX - offsetX}px`;
      currentDrag.style.top = `${e.clientY - offsetY}px`;
    }

    function dragEnd() {
      currentDrag = null;
      document.removeEventListener("mousemove", dragMove);
      document.removeEventListener("mouseup", dragEnd);
    }

    // Modal controls
    const aboutModal = document.getElementById("about-modal");
    document.getElementById("about-btn").onclick = () => {
      aboutModal.style.display = "flex";
    };
    document.getElementById("close-about").onclick = () => {
      aboutModal.style.display = "none";
    };

    // Main interaction
    document.getElementById("enter-btn").onclick = () => {
      document.getElementById("button-container").style.display = "none";
      shuffleImages();
      // Show controls with a slight delay
      setTimeout(() => {
        document.getElementById("start-btn").style.display = "block";
        document.getElementById("more-btn").style.display = "block";
        document.getElementById("about-btn").style.display = "block";
      }, 600);
    };

    document.getElementById("start-btn").onclick = shuffleImages;
    document.getElementById("more-btn").onclick = showImage;

    // Initialize
    document.addEventListener("DOMContentLoaded", loadPhotos);
  </script>

</body>
</html>
