<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>something</title>
<style>
  body {
    font-family: 'Courier New', monospace;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow: hidden;
    background: #fafafa;
    position: relative;
  }

  /* About button */
  #about-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 20px;
    font-size: 16px;
    background: black;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: bold;
    z-index: 300;
  }
  #about-btn:hover {
    background: #222;
  }

  /* About modal */
  #about-modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    z-index: 500;
    justify-content: center;
    align-items: center;
  }
  #about-content {
    background: #fff;
    padding: 30px;
    max-width: 600px;
    width: 90%;
    border-radius: 8px;
    font-size: 16px;
    line-height: 1.5;
    position: relative;
  }
  #about-close {
    position: absolute;
    top: 10px; right: 15px;
    font-size: 20px;
    font-weight: bold;
    color: #000;
    cursor: pointer;
  }
  #about-close:hover {
    color: #666;
  }

  /* Image layout */
  #results {
    width: 100%;
    height: 100vh;
    position: relative;
    top: 0;
    left: 0;
    overflow: hidden;
  }

  #results img {
    position: absolute;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    cursor: grab;
    transition: opacity 0.5s ease, transform 0.2s ease;
    opacity: 0;
  }
  #results img.loaded {
    opacity: 1;
  }
  #results img:active {
    cursor: grabbing;
  }
</style>
</head>

<body>
  <button id="about-btn">About</button>
  <div id="results"></div>

  <div id="about-modal">
    <div id="about-content">
      <span id="about-close">&times;</span>
      <h2>What is this?</h2>
      <p>My name is Devin Feilen, and this is my ongoing photography portfolio.</p>
      <p>I built this site myself to offer a more intriguing, organic experience â€” every refresh reveals a new, random spread of my work.</p>
      <p>If you'd like to support me, you can do so at <a href="https://buymeacoffee.com/devinfeilen" target="_blank">buymeacoffee.com/devinfeilen</a>.</p>
    </div>
  </div>

<script>
window.addEventListener("load", () => {
  console.log("ðŸ“¸ Page loaded, fetching photos...");
  const numPhotos = 10; // Number of images to show
  const topBuffer = 10;
  let zIndexCounter = 1;

  fetch("photos.json")
    .then(res => {
      if (!res.ok) throw new Error("Failed to load photos.json");
      return res.json();
    })
    .then(data => {
      console.log("âœ… Loaded photos.json with", data.length, "images");
      if (!Array.isArray(data) || data.length === 0) {
        console.error("âŒ photos.json is empty or invalid");
        return;
      }
      const batch = getRandomSubset(data, numPhotos);
      addImages(batch);
    })
    .catch(err => console.error("âš ï¸ Error loading photos:", err));

  function getRandomSubset(arr, n) {
    const shuffled = arr.slice().sort(() => 0.5 - Math.random());
    return shuffled.slice(0, n);
  }

  function addImages(selected) {
    const resultsDiv = document.getElementById("results");
    selected.forEach(src => {
      const img = new Image();
      img.src = src;
      img.alt = "random photo";
      img.loading = "lazy";
      img.onload = () => {
        const heightScale = Math.random() * 0.15 + 0.75; // between 75â€“90% viewport height
        const displayHeight = window.innerHeight * heightScale;
        const scale = displayHeight / img.naturalHeight;
        const width = img.naturalWidth * scale;
        const height = displayHeight;

        img.style.width = width + "px";
        img.style.height = height + "px";

        const overlapMargin = 0.1; // 10% overlap allowance
        const maxX = window.innerWidth - width * (1 - overlapMargin);
        const maxY = window.innerHeight - height * (1 - overlapMargin);
        const x = Math.random() * maxX - width * overlapMargin / 2;
        const y = Math.random() * (maxY - topBuffer) + topBuffer;

        img.style.left = x + "px";
        img.style.top = y + "px";
        img.style.zIndex = zIndexCounter++;

        makeDraggable(img);
        resultsDiv.appendChild(img);
        requestAnimationFrame(() => img.classList.add("loaded"));
      };
      img.onerror = () => console.error("âš ï¸ Could not load image:", src);
    });
  }

  function makeDraggable(img) {
    let startX, startY, initialX, initialY, dragging = false;

    img.addEventListener("pointerdown", e => {
      dragging = true;
      startX = e.clientX;
      startY = e.clientY;
      initialX = parseFloat(img.style.left);
      initialY = parseFloat(img.style.top);
      img.setPointerCapture(e.pointerId);
      img.style.zIndex = zIndexCounter++;
      img.style.cursor = "grabbing";
    });

    img.addEventListener("pointermove", e => {
      if (!dragging) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      img.style.left = initialX + dx + "px";
      img.style.top = initialY + dy + "px";
    });

    img.addEventListener("pointerup", e => {
      dragging = false;
      img.releasePointerCapture(e.pointerId);
      img.style.cursor = "grab";
    });
  }

  // About modal
  const aboutBtn = document.getElementById("about-btn");
  const aboutModal = document.getElementById("about-modal");
  const aboutClose = document.getElementById("about-close");
  aboutBtn.onclick = () => (aboutModal.style.display = "flex");
  aboutClose.onclick = () => (aboutModal.style.display = "none");
  window.onclick = e => {
    if (e.target === aboutModal) aboutModal.style.display = "none";
  };
});
</script>
</body>
</html>
